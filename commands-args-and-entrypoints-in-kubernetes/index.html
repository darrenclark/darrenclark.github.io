<html>
<head>
  
  
  
    
    
  

  <title>Commands, args, and ENTRYPOINTs in Kubernetes | Darren Clark</title>

  
  
  <link rel=stylesheet type="text/css" href="https://darrenclark.ca/style.c641f8c954d7c02b6b60bc68481d5e080a56a3080759934cef11de44a067efc325c0bc90d7212a9b512632a50a22337b4d402ff85fb4f91a4531a483c579b6ee.css"></script>

  <meta name="viewport" content="width=device-width, initial-scale=1.0">

  <link rel="canonical" content="https://darrenclark.ca/commands-args-and-entrypoints-in-kubernetes/">

  <meta property="og:title" content="Commands, args, and ENTRYPOINTs in Kubernetes">
  <meta property="og:site_name" content="Darren Clark">
  <meta property="og:url" content="https://darrenclark.ca/commands-args-and-entrypoints-in-kubernetes/">
  <meta property="og:image" content="https://darrenclark.ca/apple-touch-icon.png" />

  
  <meta property="og:type" content="article">
  <meta property="og:description" content="Perhaps one of the most perplexing parts of starting a Docker container in Kubernetes is the variety of options for specifying the command to be run.
A Dockerfile can include one or both of CMD and ENTRYPOINT instructions:
FROMalpineCMD [&#34;echo&#34;, &#34;hello, world!&#34;]FROMalpineENTRYPOINT [&#34;echo&#34;]CMD [&#34;hello, world!&#34;]FROMalpineENTRYPOINT [&#34;echo&#34;, &#34;hello, world!&#34;]Similarly, Kubernetes has command and args fields:
apiVersion:v1kind:Podmetadata:name:hello-worldspec:containers:- name:hello-worldimage:alpinecommand:[&#34;echo&#34;]args:[&#34;hello, world!&#34;]restartPolicy:OnFailureFrustratingly, the terminology doesn&rsquo;t quite line up between the two:
    command arguments     Docker ENTRYPOINT CMD   Kubernetes command args    NOTE: In the cases where command or args isn&rsquo;t set, Kubernetes will use the equivalent instruction from the Dockerfile.">
  <meta name="description" content="Perhaps one of the most perplexing parts of starting a Docker container in Kubernetes is the variety of options for specifying the command to be run.
A Dockerfile can include one or both of CMD and ENTRYPOINT instructions:
FROMalpineCMD [&#34;echo&#34;, &#34;hello, world!&#34;]FROMalpineENTRYPOINT [&#34;echo&#34;]CMD [&#34;hello, world!&#34;]FROMalpineENTRYPOINT [&#34;echo&#34;, &#34;hello, world!&#34;]Similarly, Kubernetes has command and args fields:
apiVersion:v1kind:Podmetadata:name:hello-worldspec:containers:- name:hello-worldimage:alpinecommand:[&#34;echo&#34;]args:[&#34;hello, world!&#34;]restartPolicy:OnFailureFrustratingly, the terminology doesn&rsquo;t quite line up between the two:
    command arguments     Docker ENTRYPOINT CMD   Kubernetes command args    NOTE: In the cases where command or args isn&rsquo;t set, Kubernetes will use the equivalent instruction from the Dockerfile.">
  


  
  
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-131464577-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());
    gtag('config', 'UA-131464577-1');
  </script>
  

</head>
<body class="bg-[#f4f4f4] font-sans leading-normal tracking-normal">
  <nav class="flex flex-row mx-auto items-baseline max-w-screen-md mt-4 border-solid border-b-[1px] border-amber-600 px-2 md:px-2 lg:px-0 md:pb-2">
    
      <div class="flex-grow font-extrabold text-xl">
        <a href="/">Darren Clark</a>
      </div>
    
    <ul class="flex-shrink">
      <li class="inline-block mr-2">
        <a href="/articles">Articles</a>
      </li>
    </ul>
  </nav>
  

<div class="mx-auto max-w-screen-md mt-4">
  <h1 class="text-4xl font-bold mb-3 mt-20 text-center">Commands, args, and ENTRYPOINTs in Kubernetes</h1>
  <p class="text-center text-sm">
    Published on Feb 19, 2022 in 
    
        <a class="text-orange-800 font-light" href="https://darrenclark.ca/tags/kubernetes/">#kubernetes</a>
    
  </p>

  <div class="markdown text-justify mx-4 my-20">
    <p>Perhaps one of the most perplexing parts of starting a Docker container in
Kubernetes is the variety of options for specifying the command to be run.</p>
<p>A <code>Dockerfile</code> can include one or both of <code>CMD</code> and <code>ENTRYPOINT</code> instructions:</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-docker" data-lang="docker"><span class="k">FROM</span><span class="s"> alpine</span><span class="err">
</span><span class="err"></span><span class="k">CMD</span> <span class="p">[</span><span class="s2">&#34;echo&#34;</span><span class="p">,</span> <span class="s2">&#34;hello, world!&#34;</span><span class="p">]</span><span class="err">
</span></code></pre></div><div class="highlight"><pre tabindex="0" class="chroma"><code class="language-docker" data-lang="docker"><span class="k">FROM</span><span class="s"> alpine</span><span class="err">
</span><span class="err"></span><span class="k">ENTRYPOINT</span> <span class="p">[</span><span class="s2">&#34;echo&#34;</span><span class="p">]</span><span class="err">
</span><span class="err"></span><span class="k">CMD</span> <span class="p">[</span><span class="s2">&#34;hello, world!&#34;</span><span class="p">]</span><span class="err">
</span></code></pre></div><div class="highlight"><pre tabindex="0" class="chroma"><code class="language-docker" data-lang="docker"><span class="k">FROM</span><span class="s"> alpine</span><span class="err">
</span><span class="err"></span><span class="k">ENTRYPOINT</span> <span class="p">[</span><span class="s2">&#34;echo&#34;</span><span class="p">,</span> <span class="s2">&#34;hello, world!&#34;</span><span class="p">]</span><span class="err">
</span></code></pre></div><p>Similarly, Kubernetes has <code>command</code> and <code>args</code> fields:</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-yaml" data-lang="yaml"><span class="nt">apiVersion</span><span class="p">:</span><span class="w"> </span><span class="l">v1</span><span class="w">
</span><span class="w"></span><span class="nt">kind</span><span class="p">:</span><span class="w"> </span><span class="l">Pod</span><span class="w">
</span><span class="w"></span><span class="nt">metadata</span><span class="p">:</span><span class="w">
</span><span class="w">  </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l">hello-world</span><span class="w">
</span><span class="w"></span><span class="nt">spec</span><span class="p">:</span><span class="w">
</span><span class="w">  </span><span class="nt">containers</span><span class="p">:</span><span class="w">
</span><span class="w">  </span>- <span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l">hello-world</span><span class="w">
</span><span class="w">    </span><span class="nt">image</span><span class="p">:</span><span class="w"> </span><span class="l">alpine</span><span class="w">
</span><span class="w">    </span><span class="nt">command</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="s2">&#34;echo&#34;</span><span class="p">]</span><span class="w">
</span><span class="w">    </span><span class="nt">args</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="s2">&#34;hello, world!&#34;</span><span class="p">]</span><span class="w">
</span><span class="w">  </span><span class="nt">restartPolicy</span><span class="p">:</span><span class="w"> </span><span class="l">OnFailure</span><span class="w">
</span></code></pre></div><p>Frustratingly, the terminology doesn&rsquo;t quite line up between the two:</p>
<table>
<thead>
<tr>
<th></th>
<th>command</th>
<th>arguments</th>
</tr>
</thead>
<tbody>
<tr>
<td><strong>Docker</strong></td>
<td><code>ENTRYPOINT</code></td>
<td><code>CMD</code></td>
</tr>
<tr>
<td><strong>Kubernetes</strong></td>
<td><code>command</code></td>
<td><code>args</code></td>
</tr>
</tbody>
</table>
<p><em>NOTE: In the cases where <code>command</code> or <code>args</code> isn&rsquo;t set, Kubernetes will use
the equivalent instruction from the <code>Dockerfile</code>.</em></p>
<p>Both &lsquo;command&rsquo; and &lsquo;arguments&rsquo; are lists.  As such, the &lsquo;command&rsquo; portion can
include both the executable and some arguments.</p>
<table>
<thead>
<tr>
<th>command</th>
<th>arguments</th>
<th>command run</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>[&quot;echo&quot;]</code></td>
<td><code>[&quot;hello&quot;, &quot;world&quot;]</code></td>
<td><code>echo hello world</code></td>
</tr>
<tr>
<td><code>[&quot;echo&quot;, &quot;hello&quot;]</code></td>
<td><code>[&quot;world&quot;]</code></td>
<td><code>echo hello world</code></td>
</tr>
</tbody>
</table>
<h1 id="putting-this-to-use">Putting this to use</h1>
<p>We can leverage these two fields to build Docker images that are easy to run
locally, yet are flexible when deployed.</p>
<p>In our <code>Dockerfile</code>, we&rsquo;ll use <code>ENTRYPOINT</code> to define the &ldquo;base command&rdquo; and
<code>CMD</code> to provide a set of default options.  When deploying this container,
we can override the default options by specifying <code>args</code> in our Kubernetes
manifests.</p>
<p>For example, here&rsquo;s a <code>Dockerfile</code> file using Python&rsquo;s
<a href="https://docs.python.org/3/library/http.server.html">bundled web server</a>:</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-docker" data-lang="docker"><span class="k">FROM</span><span class="s"> python:3-alpine</span><span class="err">
</span><span class="err">
</span><span class="err"></span><span class="k">WORKDIR</span><span class="s"> /site</span><span class="err">
</span><span class="err"></span><span class="k">COPY</span> index.html ./<span class="err">
</span><span class="err">
</span><span class="err"></span><span class="k">ENTRYPOINT</span> <span class="p">[</span><span class="s2">&#34;python3&#34;</span><span class="p">,</span> <span class="s2">&#34;-m&#34;</span><span class="p">,</span> <span class="s2">&#34;http.server&#34;</span><span class="p">]</span><span class="err">
</span><span class="err"></span><span class="k">CMD</span> <span class="p">[</span><span class="s2">&#34;8000&#34;</span><span class="p">]</span><span class="err">
</span></code></pre></div><p>We can build and run this locally:</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-sh" data-lang="sh">docker build -t my-python-web-server:v1 .

<span class="c1"># uses port 8000 from the Dockerfile</span>
docker run -it -p8000:8000 my-python-web-server:v1

<span class="c1"># and, we can override CMD to use a different port</span>
docker run -it -p8123:8123 my-python-web-server:v1 <span class="m">8123</span>
</code></pre></div><p>When we deploy this to Kubernetes, we can use <code>args</code> to easily set a port
to listen on:</p>
<p><em>NOTE: using a <a href="https://kubernetes.io/docs/tasks/configure-pod-container/static-pod/">static Pod</a>
for brevity, usually a <a href="https://kubernetes.io/docs/concepts/workloads/controllers/deployment/">Deployment</a> or similar would be used in a production environment.</em></p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-yaml" data-lang="yaml"><span class="c"># pod.yaml</span><span class="w">
</span><span class="w"></span><span class="nt">apiVersion</span><span class="p">:</span><span class="w"> </span><span class="l">v1</span><span class="w">
</span><span class="w"></span><span class="nt">kind</span><span class="p">:</span><span class="w"> </span><span class="l">Pod</span><span class="w">
</span><span class="w"></span><span class="nt">metadata</span><span class="p">:</span><span class="w">
</span><span class="w">  </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l">my-python-web-server</span><span class="w">
</span><span class="w"></span><span class="nt">spec</span><span class="p">:</span><span class="w">
</span><span class="w">  </span><span class="nt">containers</span><span class="p">:</span><span class="w">
</span><span class="w">  </span>- <span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l">server</span><span class="w">
</span><span class="w">    </span><span class="nt">image</span><span class="p">:</span><span class="w"> </span><span class="l">my-python-web-server:v1</span><span class="w">
</span><span class="w">    </span><span class="nt">args</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="s2">&#34;8888&#34;</span><span class="p">]</span><span class="w">
</span></code></pre></div><p>We can apply this and use <code>kubectl</code>&rsquo;s port forwarding functionality to access
our web server:</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-sh" data-lang="sh">kubectl apply -f pod.yaml

kubectl port-forward pods/my-python-web-server 8888:8888
</code></pre></div><h1 id="wrapping-up">Wrapping up</h1>
<p>By using this pattern, we&rsquo;ve:</p>
<ul>
<li>provided a set of default options to run our image locally, and</li>
<li>made it easy to override those defaults when running in Kubernetes</li>
</ul>
<p>It should also be noted, this pattern works good for the above use case.  There
are many other uses cases for these parameters.</p>

  </div>
</div>


  <footer class="text-center text-sm text-gray-500 mx-auto max-w-screen-md mt-4 border-solid border-t-[1px] border-amber-600 pb-2 mb-20">
    <p class="mt-4">Copywrite &copy; Darren Clark 2018 - 2023</p>
    <p>
      <a rel="license" class="underline" href="http://creativecommons.org/licenses/by-sa/2.5/ca/">CC BY-SA 2.5 CA</a> (content) /
      <a rel="license" class="underline" href="https://unlicense.org">Unlicense</a> (code snippets)
    </p>
  </div>
</body>
</html>
